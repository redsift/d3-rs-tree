<html>
  <head>
    <link rel="stylesheet" type="text/css" href="https://static.redsift.io/reusable/ui-rs-core/latest/css/ui-rs-core.min.css">
    <style>
    @import url(https://fonts.googleapis.com/css?family=Source+Code+Pro:300,500);  
    body {
      margin: 1em;
      background: white;
    }
    body > div {
      text-align: center;
    }
    div#buttons {
      margin-bottom: 1em;
    }

    text.ip-addr {
      font-family: "Source Code Pro", Consolas, "Liberation Mono", Menlo, Courier, monospace;
    }

    text.ip-addr.matched {    
      font-weight: 500;
    }
    
    text.matched {
      fill: #0ab93a;
    }

    text.error {
      fill: #ed1651 !important;
    }

    g.symbol path {
      cursor: zoom-in;   
    }

    table.tip {
      color: white;
      font-size: 1em;
    }

    table.tip tr {
      line-height: 1.42em;
    }
   
    table.tip th {
      text-align: right;
      padding-right: 1em;
    }


    </style> 
  </head>
  <body>
    <h3>104.146.128.0</h3>
    <div id="flare"></div>
    <div id="perm"></div>
    <div id="none"></div>
    <div id="rec"></div>
    <div id="soft"></div>
    <div id="ok"></div>
    
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="//static.redsift.io/reusable/d3-rs-theme/latest/d3-rs-theme.umd-es2015.min.js"></script>
    <script src="/d3-rs-tree.umd-es2015.min.js"></script>
    <script>

    'use strict';

    const FLARE = {
      path: [32, 39, 44],
      tree: {
		    "id": 1,
		    "effectiveValue": "cliffordchance.com.",
		    "raw": "v=spf1 ip4:52.51.164.108 ip4:52.51.165.189 ip4:52.51.165.176 ip4:5.79.47.141 ip4:94.236.70.181 ip4:134.170.204.81 include:spf.highqsolutions.com include:sharepointonline.com include:eu._netblocks.mimecast.com -all",
		    "children": [
		        {
		            "id": 2,
		            "qualifier": "+",
		            "mechanism": "ip4",
		            "value": "52.51.164.108",
		            "effectiveValue": "52.51.164.108",
		            "subnetCount": 1
		        },
		        {
		            "id": 3,
		            "qualifier": "+",
		            "mechanism": "ip4",
		            "value": "52.51.165.189",
		            "effectiveValue": "52.51.165.189",
		            "subnetCount": 1
		        },
		        {
		            "id": 4,
		            "qualifier": "+",
		            "mechanism": "ip4",
		            "value": "52.51.165.176",
		            "effectiveValue": "52.51.165.176",
		            "subnetCount": 1
		        },
		        {
		            "id": 5,
		            "qualifier": "+",
		            "mechanism": "ip4",
		            "value": "5.79.47.141",
		            "effectiveValue": "5.79.47.141",
		            "subnetCount": 1
		        },
		        {
		            "id": 6,
		            "qualifier": "+",
		            "mechanism": "ip4",
		            "value": "94.236.70.181",
		            "effectiveValue": "94.236.70.181",
		            "subnetCount": 1
		        },
		        {
		            "id": 7,
		            "qualifier": "+",
		            "mechanism": "ip4",
		            "value": "134.170.204.81",
		            "effectiveValue": "134.170.204.81",
		            "subnetCount": 1
		        },
		        {
		            "id": 8,
		            "qualifier": "+",
		            "mechanism": "include",
		            "value": "spf.highqsolutions.com",
		            "effectiveValue": "spf.highqsolutions.com.",
		            "raw": "v=spf1 ip4:213.212.88.192/26 ip4:213.212.125.128/26 ip4:213.212.110.64/26 ip4:184.106.6.191 ip4:72.3.150.219 ip4:72.32.149.13 ip4:184.106.6.191 ip4:184.106.6.184 ip4:213.167.94.41 ip4:91.74.237.68 ip4:213.167.71.123 ip4:213.132.34.195 ip4:213.132.34.196 ip4:213.167.86.8 ip4:175.45.119.206 ip4:173.252.175.119 ip4:89.202.65.133 ip4:217.79.208.133 ip4:175.45.121.238 ip4:74.205.227.134 ip4:212.9.24.229 ip4:92.43.213.229 -all",
		            "children": [
		                {
		                    "id": 9,
		                    "qualifier": "+",
		                    "mechanism": "ip4",
		                    "value": "213.212.88.192/26",
		                    "effectiveValue": "213.212.88.192/26",
		                    "subnetCount": 62,
		                    "subnetBits": 6
		                },
		                {
		                    "id": 10,
		                    "qualifier": "+",
		                    "mechanism": "ip4",
		                    "value": "213.212.125.128/26",
		                    "effectiveValue": "213.212.125.128/26",
		                    "subnetCount": 62,
		                    "subnetBits": 6
		                },
		                {
		                    "id": 11,
		                    "qualifier": "+",
		                    "mechanism": "ip4",
		                    "value": "213.212.110.64/26",
		                    "effectiveValue": "213.212.110.64/26",
		                    "subnetCount": 62,
		                    "subnetBits": 6
		                },
		                {
		                    "id": 12,
		                    "qualifier": "+",
		                    "mechanism": "ip4",
		                    "value": "184.106.6.191",
		                    "effectiveValue": "184.106.6.191",
		                    "subnetCount": 1
		                },
		                {
		                    "id": 13,
		                    "qualifier": "+",
		                    "mechanism": "ip4",
		                    "value": "72.3.150.219",
		                    "effectiveValue": "72.3.150.219",
		                    "subnetCount": 1
		                },
		                {
		                    "id": 14,
		                    "qualifier": "+",
		                    "mechanism": "ip4",
		                    "value": "72.32.149.13",
		                    "effectiveValue": "72.32.149.13",
		                    "subnetCount": 1
		                },
		                {
		                    "id": 15,
		                    "qualifier": "+",
		                    "mechanism": "ip4",
		                    "value": "184.106.6.191",
		                    "effectiveValue": "184.106.6.191",
		                    "subnetCount": 1
		                },
		                {
		                    "id": 16,
		                    "qualifier": "+",
		                    "mechanism": "ip4",
		                    "value": "184.106.6.184",
		                    "effectiveValue": "184.106.6.184",
		                    "subnetCount": 1
		                },
		                {
		                    "id": 17,
		                    "qualifier": "+",
		                    "mechanism": "ip4",
		                    "value": "213.167.94.41",
		                    "effectiveValue": "213.167.94.41",
		                    "subnetCount": 1
		                },
		                {
		                    "id": 18,
		                    "qualifier": "+",
		                    "mechanism": "ip4",
		                    "value": "91.74.237.68",
		                    "effectiveValue": "91.74.237.68",
		                    "subnetCount": 1
		                },
		                {
		                    "id": 19,
		                    "qualifier": "+",
		                    "mechanism": "ip4",
		                    "value": "213.167.71.123",
		                    "effectiveValue": "213.167.71.123",
		                    "subnetCount": 1
		                },
		                {
		                    "id": 20,
		                    "qualifier": "+",
		                    "mechanism": "ip4",
		                    "value": "213.132.34.195",
		                    "effectiveValue": "213.132.34.195",
		                    "subnetCount": 1
		                },
		                {
		                    "id": 21,
		                    "qualifier": "+",
		                    "mechanism": "ip4",
		                    "value": "213.132.34.196",
		                    "effectiveValue": "213.132.34.196",
		                    "subnetCount": 1
		                },
		                {
		                    "id": 22,
		                    "qualifier": "+",
		                    "mechanism": "ip4",
		                    "value": "213.167.86.8",
		                    "effectiveValue": "213.167.86.8",
		                    "subnetCount": 1
		                },
		                {
		                    "id": 23,
		                    "qualifier": "+",
		                    "mechanism": "ip4",
		                    "value": "175.45.119.206",
		                    "effectiveValue": "175.45.119.206",
		                    "subnetCount": 1
		                },
		                {
		                    "id": 24,
		                    "qualifier": "+",
		                    "mechanism": "ip4",
		                    "value": "173.252.175.119",
		                    "effectiveValue": "173.252.175.119",
		                    "subnetCount": 1
		                },
		                {
		                    "id": 25,
		                    "qualifier": "+",
		                    "mechanism": "ip4",
		                    "value": "89.202.65.133",
		                    "effectiveValue": "89.202.65.133",
		                    "subnetCount": 1
		                },
		                {
		                    "id": 26,
		                    "qualifier": "+",
		                    "mechanism": "ip4",
		                    "value": "217.79.208.133",
		                    "effectiveValue": "217.79.208.133",
		                    "subnetCount": 1
		                },
		                {
		                    "id": 27,
		                    "qualifier": "+",
		                    "mechanism": "ip4",
		                    "value": "175.45.121.238",
		                    "effectiveValue": "175.45.121.238",
		                    "subnetCount": 1
		                },
		                {
		                    "id": 28,
		                    "qualifier": "+",
		                    "mechanism": "ip4",
		                    "value": "74.205.227.134",
		                    "effectiveValue": "74.205.227.134",
		                    "subnetCount": 1
		                },
		                {
		                    "id": 29,
		                    "qualifier": "+",
		                    "mechanism": "ip4",
		                    "value": "212.9.24.229",
		                    "effectiveValue": "212.9.24.229",
		                    "subnetCount": 1
		                },
		                {
		                    "id": 30,
		                    "qualifier": "+",
		                    "mechanism": "ip4",
		                    "value": "92.43.213.229",
		                    "effectiveValue": "92.43.213.229",
		                    "subnetCount": 1
		                },
		                {
		                    "id": 31,
		                    "qualifier": "-",
		                    "mechanism": "all"
		                }
		            ],
		            "rfc4408DnsCount": 1,
		            "rfc7208DnsCount": 1
		        },
		        {
		            "id": 32,
		            "qualifier": "+",
		            "mechanism": "include",
		            "value": "sharepointonline.com",
		            "effectiveValue": "sharepointonline.com.",
		            "raw": "v=spf1 ip6:2a01:111:f402::/48 ip6:2801:80:1d0:1400::/54 ip6:2620:1ec:a92::150 ip6:2620:1ec:4::150 ip6:2620:1ec:6::129 ip4:52.104.0.0/14 include:spf-a.sharepointonline.com -all",
		            "children": [
		                {
		                    "id": 33,
		                    "qualifier": "+",
		                    "mechanism": "ip6",
		                    "value": "2a01:111:f402::/48",
		                    "effectiveValue": "2a01:111:f402::/48",
		                    "subnetCount": 18446744073709551615,
		                    "subnetBits": 80
		                },
		                {
		                    "id": 34,
		                    "qualifier": "+",
		                    "mechanism": "ip6",
		                    "value": "2801:80:1d0:1400::/54",
		                    "effectiveValue": "2801:80:1d0:1400::/54",
		                    "subnetCount": 18446744073709551615,
		                    "subnetBits": 74
		                },
		                {
		                    "id": 35,
		                    "qualifier": "+",
		                    "mechanism": "ip6",
		                    "value": "2620:1ec:a92::150",
		                    "effectiveValue": "2620:1ec:a92::150",
		                    "subnetCount": 1
		                },
		                {
		                    "id": 36,
		                    "qualifier": "+",
		                    "mechanism": "ip6",
		                    "value": "2620:1ec:4::150",
		                    "effectiveValue": "2620:1ec:4::150",
		                    "subnetCount": 1
		                },
		                {
		                    "id": 37,
		                    "qualifier": "+",
		                    "mechanism": "ip6",
		                    "value": "2620:1ec:6::129",
		                    "effectiveValue": "2620:1ec:6::129",
		                    "subnetCount": 1
		                },
		                {
		                    "id": 38,
		                    "qualifier": "+",
		                    "mechanism": "ip4",
		                    "value": "52.104.0.0/14",
		                    "effectiveValue": "52.104.0.0/14",
		                    "subnetCount": 262142,
		                    "subnetBits": 18
		                },
		                {
		                    "id": 39,
		                    "qualifier": "+",
		                    "mechanism": "include",
		                    "value": "spf-a.sharepointonline.com",
		                    "effectiveValue": "spf-a.sharepointonline.com.",
		                    "raw": "v=spf1 ip4:40.108.128.0/17 ip4:104.146.128.0/17 ip4:104.146.0.0/19 ip4:40.108.0.0/19 ip4:191.235.0.0/20 ip4:134.170.200.0/21  ip4:191.234.128.0/21 include:spf-b.sharepointonline.com -all",
		                    "children": [
		                        {
		                            "id": 40,
		                            "qualifier": "+",
		                            "mechanism": "ip4",
		                            "value": "40.108.128.0/17",
		                            "effectiveValue": "40.108.128.0/17",
		                            "subnetCount": 32766,
		                            "subnetBits": 15
		                        },
		                        {
		                            "id": 41,
		                            "qualifier": "+",
		                            "mechanism": "ip4",
		                            "value": "104.146.128.0/17",
		                            "effectiveValue": "104.146.128.0/17",
		                            "subnetCount": 32766,
		                            "subnetBits": 15
		                        },
		                        {
		                            "id": 42,
		                            "qualifier": "+",
		                            "mechanism": "ip4",
		                            "value": "104.146.0.0/19",
		                            "effectiveValue": "104.146.0.0/19",
		                            "subnetCount": 8190,
		                            "subnetBits": 13
		                        },
		                        {
		                            "id": 43,
		                            "qualifier": "+",
		                            "mechanism": "ip4",
		                            "value": "40.108.0.0/19",
		                            "effectiveValue": "40.108.0.0/19",
		                            "subnetCount": 8190,
		                            "subnetBits": 13
		                        },
		                        {
		                            "id": 44,
		                            "qualifier": "+",
		                            "mechanism": "ip4",
		                            "value": "191.235.0.0/20",
		                            "effectiveValue": "191.235.0.0/20",
		                            "subnetCount": 4094,
		                            "subnetBits": 12,
                                "errors": [ 'TEST' ]
		                        }
		                    ],
		                    "rfc4408DnsCount": 1,
		                    "rfc7208DnsCount": 1
		                }
		            ],
		            "rfc4408DnsCount": 1,
		            "rfc7208DnsCount": 1
		        }
		    ]
		}};

    const PERM = {
      path: [2],
      tree: {
    "id": 1,
    "effectiveValue": "mal.test.redsift.io.",
    "raw": "v=spf1 ip4:567.24.2.3 ~all",
    "children": [
        {
            "mechanism": "ip4",
            "value": "567.24.2.3",
            "result": "permerror",
            "id": 2,
            "qualifier": "+",
            "effectiveValue": "567.24.2.3",
            "subnetCount": 1
        }
    ],
    "errors": [
        {
            "error": "address isn't ipv4",
            "value": "ip4:567.24.2.3"
        }
    ]
}
    };

    const NONE = {
      path: [],
      tree: {
    "id": 1,
    "effectiveValue": "jnk.test.redsift.io.",
    "errors": [
        {
            "error": "SPF record not found"
        }
    ]
}
    };
;

    const RECURSE = {
      path: [6, 4, 3],
      tree: {
    "id": 1,
    "effectiveValue": "rea.test.redsift.io.",
    "raw": "v=spf1 ip4:192.0.0.2 include:reb.test.redsift.io ~all",
    "children": [
        {
            "mechanism": "ip4",
            "value": "192.0.0.2",
            "id": 2,
            "qualifier": "+",
            "effectiveValue": "192.0.0.2",
            "subnetCount": 1
        },
        {
            "mechanism": "include",
            "value": "reb.test.redsift.io",
            "result": "permerror",
            "id": 3,
            "qualifier": "+",
            "effectiveValue": "reb.test.redsift.io.",
            "raw": "v=spf1 include:rea.test.redsift.io ip4:192.0.0.3 ~all",
            "children": [
                {
                    "mechanism": "include",
                    "value": "rea.test.redsift.io",
                    "result": "permerror",
                    "id": 4,
                    "qualifier": "+",
                    "effectiveValue": "rea.test.redsift.io.",
                    "raw": "v=spf1 ip4:192.0.0.2 include:reb.test.redsift.io ~all",
                    "children": [
                        {
                            "mechanism": "ip4",
                            "value": "192.0.0.2",
                            "id": 5,
                            "qualifier": "+",
                            "effectiveValue": "192.0.0.2",
                            "subnetCount": 1
                        },
                        {
                            "mechanism": "include",
                            "value": "reb.test.redsift.io",
                            "result": "permerror",
                            "id": 6,
                            "qualifier": "+",
                            "effectiveValue": "reb.test.redsift.io.",
                            "rfc4408DnsCount": 1,
                            "rfc7208DnsCount": 1,
                            "errors": [
                                {
                                    "error": "infinite recursion detected"
                                }
                            ]
                        }
                    ],
                    "rfc4408DnsCount": 1,
                    "rfc7208DnsCount": 1,
                    "errors": [
                        {
                            "error": "infinite recursion detected",
                            "value": "include:reb.test.redsift.io"
                        }
                    ]
                }
            ],
            "rfc4408DnsCount": 1,
            "rfc7208DnsCount": 1,
            "errors": [
                {
                    "error": "error checking 'include:reb.test.redsift.io': infinite recursion detected",
                    "value": "include:rea.test.redsift.io"
                }
            ]
        }
    ],
    "errors": [
        {
            "error": "error checking 'include:rea.test.redsift.io': error checking 'include:reb.test.redsift.io': infinite recursion detected",
            "value": "include:reb.test.redsift.io"
        }
    ]
}
    };

    const SOFT = {
      path: [3],
tree: {
    "id": 1,
    "effectiveValue": "ptr.test.redsift.io.",
    "raw": "v=spf1 ptr ~all",
    "children": [
        {
            "mechanism": "ptr",
            "id": 2,
            "qualifier": "+",
            "effectiveValue": "ptr.test.redsift.io",
            "rfc4408DnsCount": 1,
            "rfc7208DnsCount": 1
        },
        {
            "mechanism": "all",
            "result": "softfail",
            "id": 3,
            "qualifier": "~"
        }
    ]
}
    };

    const OK = {
      path: [27, 32, 40],
      tree: {
    "id": 1,
    "effectiveValue": "subito.it.",
    "raw": "v=spf1 mx:blocket.se include:spf.mailjet.com include:servers.mcsv.net ip4:109.168.127.160/27 ip4:212.31.252.64/27 ip4:212.77.68.6 ip4:62.212.1.160 ip4:62.212.0.160 ip4:93.94.32.0/21 ip4:93.94.37.253 ip4:109.168.121.48/28 ip4:37.202.20.23/32 ip4:213.215.152.254/32 ip4:213.215.152.253/32 ip4:213.215.152.252/32 ip4:213.215.152.251/32 ip4:109.168.121.54/32 ip4:109.168.121.55/32 ip4:109.168.121.57/32 ip4:109.168.121.58/32 -all",
    "children": [
        {
            "mechanism": "mx",
            "value": "blocket.se",
            "id": 2,
            "qualifier": "+",
            "effectiveValue": "blocket.se.",
            "children": [
                {
                    "mechanism": "a",
                    "value": "blocket.se",
                    "id": 3,
                    "effectiveValue": "alt2.aspmx.l.google.com.",
                    "children": [
                        {
                            "mechanism": "ip4",
                            "value": "blocket.se",
                            "id": 4,
                            "effectiveValue": "74.125.24.26",
                            "subnetCount": 1
                        },
                        {
                            "mechanism": "ip6",
                            "value": "blocket.se",
                            "id": 5,
                            "effectiveValue": "2404:6800:4003:c03::1b",
                            "subnetCount": 1
                        }
                    ],
                    "rfc7208DnsCount": 1
                },
                {
                    "mechanism": "a",
                    "value": "blocket.se",
                    "id": 6,
                    "effectiveValue": "aspmx2.googlemail.com.",
                    "children": [
                        {
                            "mechanism": "ip4",
                            "value": "blocket.se",
                            "id": 7,
                            "effectiveValue": "64.233.165.26",
                            "subnetCount": 1
                        },
                        {
                            "mechanism": "ip6",
                            "value": "blocket.se",
                            "id": 8,
                            "effectiveValue": "2a00:1450:4010:c08::1a",
                            "subnetCount": 1
                        }
                    ],
                    "rfc7208DnsCount": 1
                },
                {
                    "mechanism": "a",
                    "value": "blocket.se",
                    "id": 9,
                    "effectiveValue": "aspmx.l.google.com.",
                    "children": [
                        {
                            "mechanism": "ip4",
                            "value": "blocket.se",
                            "id": 10,
                            "effectiveValue": "64.233.166.26",
                            "subnetCount": 1
                        },
                        {
                            "mechanism": "ip6",
                            "value": "blocket.se",
                            "id": 11,
                            "effectiveValue": "2a00:1450:400c:c0a::1b",
                            "subnetCount": 1
                        }
                    ],
                    "rfc7208DnsCount": 1
                },
                {
                    "mechanism": "a",
                    "value": "blocket.se",
                    "id": 12,
                    "effectiveValue": "alt1.aspmx.l.google.com.",
                    "children": [
                        {
                            "mechanism": "ip4",
                            "value": "blocket.se",
                            "id": 13,
                            "effectiveValue": "64.233.165.26",
                            "subnetCount": 1
                        },
                        {
                            "mechanism": "ip6",
                            "value": "blocket.se",
                            "id": 14,
                            "effectiveValue": "2a00:1450:4010:c08::1b",
                            "subnetCount": 1
                        }
                    ],
                    "rfc7208DnsCount": 1
                },
                {
                    "mechanism": "a",
                    "value": "blocket.se",
                    "id": 15,
                    "effectiveValue": "aspmx3.googlemail.com.",
                    "children": [
                        {
                            "mechanism": "ip4",
                            "value": "blocket.se",
                            "id": 16,
                            "effectiveValue": "74.125.24.26",
                            "subnetCount": 1
                        },
                        {
                            "mechanism": "ip6",
                            "value": "blocket.se",
                            "id": 17,
                            "effectiveValue": "2404:6800:4003:c03::1a",
                            "subnetCount": 1
                        }
                    ],
                    "rfc7208DnsCount": 1
                }
            ],
            "rfc4408DnsCount": 1,
            "rfc7208DnsCount": 1
        },
        {
            "mechanism": "include",
            "value": "spf.mailjet.com",
            "id": 18,
            "qualifier": "+",
            "effectiveValue": "spf.mailjet.com.",
            "raw": "v=spf1 ip4:178.33.111.144 ip4:178.33.137.208/28 ip4:178.33.221.0/24 ip4:37.59.69.128/25 ip4:37.59.249.0/24 ip4:87.253.232.0/21 ip4:185.189.236.0/22 ip4:185.211.120.0/22 ?all",
            "children": [
                {
                    "mechanism": "ip4",
                    "value": "178.33.111.144",
                    "id": 19,
                    "qualifier": "+",
                    "effectiveValue": "178.33.111.144",
                    "subnetCount": 1
                },
                {
                    "mechanism": "ip4",
                    "value": "178.33.137.208/28",
                    "id": 20,
                    "qualifier": "+",
                    "effectiveValue": "178.33.137.208/28",
                    "subnetCount": 14,
                    "subnetBits": 4
                },
                {
                    "mechanism": "ip4",
                    "value": "178.33.221.0/24",
                    "id": 21,
                    "qualifier": "+",
                    "effectiveValue": "178.33.221.0/24",
                    "subnetCount": 254,
                    "subnetBits": 8
                },
                {
                    "mechanism": "ip4",
                    "value": "37.59.69.128/25",
                    "id": 22,
                    "qualifier": "+",
                    "effectiveValue": "37.59.69.128/25",
                    "subnetCount": 126,
                    "subnetBits": 7
                },
                {
                    "mechanism": "ip4",
                    "value": "37.59.249.0/24",
                    "id": 23,
                    "qualifier": "+",
                    "effectiveValue": "37.59.249.0/24",
                    "subnetCount": 254,
                    "subnetBits": 8
                },
                {
                    "mechanism": "ip4",
                    "value": "87.253.232.0/21",
                    "id": 24,
                    "qualifier": "+",
                    "effectiveValue": "87.253.232.0/21",
                    "subnetCount": 2046,
                    "subnetBits": 11
                },
                {
                    "mechanism": "ip4",
                    "value": "185.189.236.0/22",
                    "id": 25,
                    "qualifier": "+",
                    "effectiveValue": "185.189.236.0/22",
                    "subnetCount": 1022,
                    "subnetBits": 10
                },
                {
                    "mechanism": "ip4",
                    "value": "185.211.120.0/22",
                    "id": 26,
                    "qualifier": "+",
                    "effectiveValue": "185.211.120.0/22",
                    "subnetCount": 1022,
                    "subnetBits": 10
                },
                {
                    "mechanism": "all",
                    "result": "neutral",
                    "id": 27,
                    "qualifier": "?"
                }
            ],
            "rfc4408DnsCount": 1,
            "rfc7208DnsCount": 1
        },
        {
            "mechanism": "include",
            "value": "servers.mcsv.net",
            "id": 28,
            "qualifier": "+",
            "effectiveValue": "servers.mcsv.net.",
            "raw": "v=spf1 ip4:205.201.128.0/20 ip4:198.2.128.0/18 ip4:148.105.8.0/21 ?all",
            "children": [
                {
                    "mechanism": "ip4",
                    "value": "205.201.128.0/20",
                    "id": 29,
                    "qualifier": "+",
                    "effectiveValue": "205.201.128.0/20",
                    "subnetCount": 4094,
                    "subnetBits": 12
                },
                {
                    "mechanism": "ip4",
                    "value": "198.2.128.0/18",
                    "id": 30,
                    "qualifier": "+",
                    "effectiveValue": "198.2.128.0/18",
                    "subnetCount": 16382,
                    "subnetBits": 14
                },
                {
                    "mechanism": "ip4",
                    "value": "148.105.8.0/21",
                    "id": 31,
                    "qualifier": "+",
                    "effectiveValue": "148.105.8.0/21",
                    "subnetCount": 2046,
                    "subnetBits": 11
                },
                {
                    "mechanism": "all",
                    "result": "neutral",
                    "id": 32,
                    "qualifier": "?"
                }
            ],
            "rfc4408DnsCount": 1,
            "rfc7208DnsCount": 1
        },
        {
            "mechanism": "ip4",
            "value": "109.168.127.160/27",
            "id": 33,
            "qualifier": "+",
            "effectiveValue": "109.168.127.160/27",
            "subnetCount": 30,
            "subnetBits": 5
        },
        {
            "mechanism": "ip4",
            "value": "212.31.252.64/27",
            "id": 34,
            "qualifier": "+",
            "effectiveValue": "212.31.252.64/27",
            "subnetCount": 30,
            "subnetBits": 5
        },
        {
            "mechanism": "ip4",
            "value": "212.77.68.6",
            "id": 35,
            "qualifier": "+",
            "effectiveValue": "212.77.68.6",
            "subnetCount": 1
        },
        {
            "mechanism": "ip4",
            "value": "62.212.1.160",
            "id": 36,
            "qualifier": "+",
            "effectiveValue": "62.212.1.160",
            "subnetCount": 1
        },
        {
            "mechanism": "ip4",
            "value": "62.212.0.160",
            "id": 37,
            "qualifier": "+",
            "effectiveValue": "62.212.0.160",
            "subnetCount": 1
        },
        {
            "mechanism": "ip4",
            "value": "93.94.32.0/21",
            "id": 38,
            "qualifier": "+",
            "effectiveValue": "93.94.32.0/21",
            "subnetCount": 2046,
            "subnetBits": 11
        },
        {
            "mechanism": "ip4",
            "value": "93.94.37.253",
            "id": 39,
            "qualifier": "+",
            "effectiveValue": "93.94.37.253",
            "subnetCount": 1
        },
        {
            "mechanism": "ip4",
            "value": "109.168.121.48/28",
            "result": "pass",
            "id": 40,
            "qualifier": "+",
            "effectiveValue": "109.168.121.48/28",
            "subnetCount": 14,
            "subnetBits": 4
        }
    ]
}
    }

    function qualifierString(q) {
      if (q === '+') {
        return 'Pass';
      } else if (q === '-') {
        return 'Fail';
      } else if (q === '~') {
        return 'Softfail';
      } else if (q === '?') {
        return 'Neutral';
      } else {
        return 'Unknown';
      }
    }

    function label(d) {
      if (d.data.mechanism === 'all') {
        return qualifierString(d.data.qualifier) + ' All';
      }
      var value = d.data.effectiveValue ? d.data.effectiveValue : d.data.value ? d.data.value : ''; 

      return (d.data.mechanism ? d.data.mechanism + ': ' : value === '' ? '?' : '') + value;
    }

    var triangle = d3.symbol().type(d3.symbolTriangle);
    var circle = d3.symbol().type(d3.symbolCircle);

    var theme = 'light';

    var fieldFn = (d) => '';
    function hasError(d) {
        return d.data.errors && d.data.errors.length > 0;
    }

    function hasErrorOrErrorResult(d) {
      if (hasError(d)) return true;
      if (d.data.result && d.data.result != 'pass') return true;

      return false;
    }
    
    var unmatchedNode = 2,
        textNode = 9,
        matchedNode = 14;

    function redundantValues(a, b) {
      if (a == null || b == null) return false;
      if (a == b) return true;
      return (b.indexOf(a) == -1) ? false : true;
    }



    var nd = null;
    var linked = false;

    function update(select, source, animated) {
      var path = new Set([1].concat(source.path));

    var tree = d3_rs_tree.html(select)
                    .width(404)
                    .theme(theme)
                    .label(label)
                    .nodeRadius(function (d) {
                      if (d == null) return textNode;
                        if (path.has(d.id)) {
                          return matchedNode;
                        }
                        return unmatchedNode;
                    })
                    .badge(function (d) {
                        return fieldFn(d);
                    })
                    .nodeFill(function (d) {
                        if (hasError(d)) {
                            return d3_rs_theme.brand.standard[d3_rs_theme.brand.names.red]; // error
                        }
                        if (d.hasChildren) {
                            if (path.has(d.id)) {
                              return d3_rs_theme.brand.standard[d3_rs_theme.brand.names.green]; // matched node with children
                            }
                            return d3_rs_theme.display[theme].axis; // unmatched node with children
                        }
                        return null;
                    })
                    .pathFill(function (d) {
                      return (path.has(d.data.id) && (d.parent.data.id)) ? d3_rs_theme.brand.standard[d3_rs_theme.brand.names.green] : d3_rs_theme.display[theme].grid;
                    })
                    .nodeSymbol(function (d) { 
                        return hasError(d) ? triangle : circle
                    })
                    .nameClass(function (d) {
                      var matched = path.has(d.id) ? ' matched' : ' not'; // matches display classes
                      var error = hasErrorOrErrorResult(d) ? ' error' : '';
                      return d.hasChildren ? 'default'+matched+error : 'ip-addr'+matched+error;
                    })
                    .nameOpacity(function (d) {
                      if (d.labelHidden || d.hasChildren) return 0;
                      console.log(d);
                      return 1.0;
                    })
                    .tipHtml(function (d) {
                      var data = d.data;
                      var errorHtml = '';
                      if (data.errors && data.errors.length > 0) {
                        errorHtml = `<table class='errors'>
                        ${
                          data.errors.map(function(e){
                            return `<tr><td>${e}<td></tr>`
                          })
                        }
                        </table>
                        `;
                      }

                      if (data.qualifier == null) {
                        return errorHtml + `<table class='tip'>
                        <tr><th>${data.value ? 'Value' : 'Calculated Value'}</th><td>${data.value ? data.value : data.effectiveValue}</td></tr>
                        <tr><th>Contained Mechanisms</th><td>${d.value}</td></tr>
                        </table>
                        `;
                      }
                      if (redundantValues(data.value, data.effectiveValue)) {
                        return errorHtml + `<table class='tip'>
                        <tr><th>Mechanism</th><td>${data.qualifier}${data.mechanism}</td></tr>
                        <tr><th>Value</th><td>${data.value}</td></tr>
                        <tr><th>Contained Mechanisms</th><td>${d.value}</td></tr>                        
                        </table>
                        `;
                      }
                      
                      return errorHtml + `<table class='tip'>
                      <tr><th>Mechanism</th><td>${data.qualifier}${data.mechanism}</td></tr>
                      <tr><th>Value</th><td>${data.value}</td></tr>
                      <tr><th>Calculated Value</th><td>${data.effectiveValue}</td></tr>
                      <tr><th>Contained Mechanisms</th><td>${d.value}</td></tr>                      
                      </table>
                      `;
                       
                    })
                    .interactive(false);
      var data = d3_rs_tree
                .mapChildren(source.tree, label)
                .sum(function (d) { 
                  return d.children ? d.children.length + 1 : 1
                });

      data.eachAfter(d => {
        if (path.has(d.data.id)) {
          return;
        }
        
        // collapse the rest
        if (d.children) {
          d._children = d.children;
          d.children = null;
        }
      });

      let svg = d3.select(`#${select}`).datum(data);
      if (animated) {
        svg = svg.transition().duration(666);
      }  
      svg.call(tree);
    }

    update('flare', FLARE, false);

    update('perm', PERM, false);

    update('none', NONE, false);

    update('rec', RECURSE, false);
    
    update('soft', SOFT, false);

    update('ok', OK, false);    
/*
    tree.onClick(function (d) {
      if (d.children) {
        d._children = d.children;
        d.children = null;
      } else {
        d.children = d._children;
        d._children = null;
      }
      update(true);
    });
*/

    </script>
  </body>
</html>
